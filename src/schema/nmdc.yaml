id: https://microbiomedata/schema
name: NMDC
title: NMDC Schema

description: >-
  Schema for National Microbiome Data Collaborative (NMDC).
  This schem is organized into 3 separate modules:
    
  This schema is organized into distinct modules:
    
   * a set of core types for representing data values
   * the mixs schema (auto-translated from mixs excel)
   * annotation schema
   * the NMDC schema itself
  
license: https://creativecommons.org/publicdomain/zero/1.0/
version: 2021.06.30

prefixes:
  nmdc: https://microbiomedata/meta/
  GOLD: https://identifiers.org/gold/
  mixs: https://w3id.org/gensc/
  wgs: http://www.w3.org/2003/01/geo/wgs84_pos
  qud: http://qudt.org/1.1/schema/qudt#
  dcterms: http://purl.org/dc/terms/
  linkml: https://w3id.org/linkml/
  MS: http://purl.obolibrary.org/obo/MS_
  OBI: http://purl.obolibrary.org/obo/OBI_
  NCIT: http://purl.obolibrary.org/obo/NCIT_
  igsn: https://app.geosamples.org/sample/igsn/
  
default_prefix: nmdc
default_range: string

default_curi_maps:
  - obo_context
  - idot_context

emit_prefixes:
  - rdf
  - rdfs
  - xsd
  - skos

# This file organizes the main NMDC schema.
# It brings in the mixs schema plus a schemaa
# of core types
imports:
  - linkml:types
  - mixs
  - core
  - prov
  - workflow_execution_activity
  - annotation

subsets:
  sample subset:
    description: >-
      Subset consisting of entities linked to the processing of samples. 
      Currently, this subset consists of study, omics process, and biosample.
  
  data object subset:
    description: >-
      Subset consisting of the data objects that either inputs or outputs of processes or workflows.

classes:

  database:
    aliases:
      - "NMDC metadata object"
    description: >-
      An abstract holder for any set of metadata and data. It does not need to correspond to an actual managed databse
      top level holder class. When translated to JSON-Schema this is the 'root' object.
      It should contain pointers to other objects of interest
    slots:
      - biosample set
      - study set
      - data object set
      - activity set
      - mags activity set
      - metabolomics analysis activity set
      - metaproteomics analysis activity set
      - metagenome annotation activity set
      - metagenome assembly set
      - metatranscriptome activity set
      - read QC analysis activity set
      - read based analysis activity set
      - nom analysis activity set
      - omics processing set
      - functional annotation set
      - genome feature set
    slot_usage:
      nmdc schema version:
        description: >-
            TODO
      date created:
        description: >-
            TODO
      etl software version:
        description: >-
            TODO
  
  data object:
    is_a: named thing
    in_subset:
      - data object subset
    description: >-
      An object that primarily consists of symbols that represent information.  
      Files, records, and omics data are examples of data objects. 
    slots:
      - file size bytes
      - md5 checksum
      - data object type
      - compression type
      - was generated by
      - url
      - type  # custom slot that specifies object type
    slot_usage:
      name:
        required: true
      description:
        required: true
    id_prefixes:
      - GOLD

  biosample:
    is_a: named thing
    in_subset: 
      - sample subset
    aliases: ['sample', 'material sample', 'specimen', 'biospecimen']
    description: >-
      A material sample. It may be environmental (encompassing many organisms) or isolate or tissue.  
      An environmental sample containing genetic material from multiple individuals is commonly referred to as a biosample.
    slots:
      - type  # custom slot that specifies object type
      - alternative identifiers
    
      # MIXS slots
      - agrochem_addition
      - alkalinity
      - alkalinity_method
      - alkyl_diethers
      - alt
      - al_sat
      - al_sat_meth
      - aminopept_act
      - ammonium
      - annual_precpt      
      - annual_temp
      - bacteria_carb_prod
      - bishomohopanol
      - bromide
      - calcium
      - carb_nitro_ratio
      - chem_administration
      - chloride
      - chlorophyll
      - collection_date
      - cur_land_use
      - cur_vegetation
      - cur_vegetation_meth
      - crop_rotation
      - density
      - depth
      - diss_carb_dioxide
      - diss_hydrogen
      - diss_inorg_carb
      - diss_inorg_phosp
      - diss_org_carb
      - diss_org_nitro
      - diss_oxygen
      - drainage_class      
      - elev
      - env_package
      - env_broad_scale
      - env_local_scale
      - env_medium
      - extreme_event      
      - fao_class      
      - fire
      - flooding  
      - geo_loc_name
      - glucosidase_act
      - heavy_metals
      - heavy_metals_meth
      - horizon
      - horizon_meth      
      - lat_lon
      - link_addit_analys      
      - link_class_info      
      - link_climate_info
      - local_class
      - local_class_meth
      - magnesium
      - mean_frict_vel
      - mean_peak_frict_vel
      - microbial_biomass
      - microbial_biomass_meth      
      - misc_param
      - n_alkanes
      - nitrate
      - nitrite
      - org_matter
      - org_nitro
      - organism_count
      - oxy_stat_samp
      - part_org_carb
      - perturbation
      - petroleum_hydrocarb
      - ph
      - ph_meth
      - phaeopigments
      - phosplipid_fatt_acid
      - pool_dna_extracts
      - potassium
      - pressure
      - previous_land_use
      - previous_land_use_meth
      - profile_position
      - redox_potential
      - salinity
      - salinity_meth
      - samp_collect_device
      - samp_mat_process
      - samp_store_dur
      - samp_store_loc
      - samp_store_temp     
      - samp_vol_we_dna_ext
      - season_temp
      - season_precpt      
      - sieving
      - size_frac_low
      - size_frac_up
      - slope_gradient
      - slope_aspect
      - sodium
      - soil_type
      - soil_type_meth
      - store_cond
      - sulfate
      - sulfide
      - temp     
      - texture
      - texture_meth      
      - tillage
      - tidal_stage
      - tot_carb
      - tot_depth_water_col
      - tot_diss_nitro
      - tot_org_carb
      - tot_org_c_meth
      - tot_nitro_content
      - tot_nitro_content_meth
      - tot_phosp
      - water_content
      - water_content_soil_meth
      
      # GOLD path fields
      - ecosystem
      - ecosystem_category
      - ecosystem_type
      - ecosystem_subtype
      - specific_ecosystem

      # GOLD specific fields
      - add_date
      - community
      - depth2
      - habitat
      - host_name
      - identifier
      - location
      - mod_date
      - ncbi_taxonomy_name
      - proport_woa_temperature
      - salinity_category # note: maps to gold:salinity
      - sample_collection_site
      - soluble_iron_micromol
      - subsurface_depth
      - subsurface_depth2
    slot_usage:
      lat_lon:
        required: false
        description: >-
          This is currently a required field but it's not clear if this should be required for human hosts
      part of:
        required: false
        range: study
        description: >-
          Relates the biosample to the study for which the sample was collected.
      env_broad_scale:
        required: true
      env_local_scale:
        required: true
      env_medium:
        required: true
    id_prefixes:
      - GOLD
    exact_mappings:
      - OBI:0000747
      - NCIT:C43412
        
  study:
    is_a: named thing
    in_subset: 
      - sample subset
    aliases: ['proposal', 'research proposal', 'research study', 'investigation', 'project']
    description: >-
      A study summarizes the overall goal of a research initiative and outlines the key objective of its underlying projects.  
    slots:
      - ecosystem
      - ecosystem_category
      - ecosystem_type
      - ecosystem_subtype
      - specific_ecosystem
      - principal investigator
      - doi
      - title
      - alternative titles
      - alternative descriptions
      - alternative names
      - abstract
      - objective
      - websites
      - publications
      - type  # custom slot that specifies object type
      - SRA studies
      - GOLD studies
      - bioprojects
      - MGnify projects
    slot_usage:
      doi:
        description: >-
          The dataset citation for this study
    exact_mappings:
      - SIO:001066  ## study
      - NCIT:C63536 ## study
      - OBI:0000066 ## investigation
      - ISA:Study
    closed_mappings:
      - NCIT:C41198 ## investigation
      - ISA:Investigation
    todos:
      - determine how to get data values for submitted_to_insdc, investigation_type, experimental_factor
      - project_name is redundant with name, so excluding it
    id_spaces:
      - GOLD ## https://identifiers.org/gold:Gs0110115
      - ena.embl ## https://www.ebi.ac.uk/ena/browser/view/PRJEB45055?
      - mgnify ## https://www.ebi.ac.uk/metagenomics/studies/MGYS00005757
          
  biosample processing:
    aliases:
      - material processing
    is_a: named thing
    description: >-
      A process that takes one or more biosamples as inputs and generates one or as outputs.
      Examples of outputs include samples cultivated from another sample or data objects created by instruments runs.
    slots:
      - has input
    slot_usage:
      has input:
        range: biosample
    broad_mappings:
      - OBI:0000094 ## material processing: https://github.com/microbiomedata/nmdc-metadata/issues/171

  omics processing:
    aliases:
      - omics assay
    is_a: biosample processing
    in_subset: 
      - sample subset
    description: >-
      The methods and processes used to generate omics data from a biosample or organism.
    comments:
      - The IDs for objects coming from GOLD will have prefixes gold:GpNNNN
    slots:
      - add_date
      - mod_date
      - has input
      - has output
      - instrument_name
      - ncbi_project_name
      - omics type
      - part of
      - principal investigator
      - processing_institution
      - type  # custom slot that specifies object type
    slot_usage:
      has input:
        required: true
      has output:
        required: true
      part of:
        required: true
    broad_mappings:
      - OBI:0000070 ## assay: https://github.com/microbiomedata/nmdc-metadata/issues/171
  
  
enums:
  file type enum:
    permissible_values:
      assembly_contigs.fna: 
        description: Final assembly contigs fasta.
      assembly_scaffolds.fna:
        description: Final assembly scaffolds fasta.
      assembly.agp:
        description: An AGP format file describes the assembly.
      filterStats.txt:
        description: Reads QC summary statistics
      filtered.fastq.gz:
        description: Reads QC result fastq (clean data)
      mapping_stats.txt :
        description: Assembled contigs coverage information 
      pairedMapped_sorted.bam:
        description: Sorted bam file of reads mapping back to the final assembly.
      KO TSV:
        description: Tab delimited file for KO annotation.
      EC TSV:
        description: Tab delimited file for EC annotation.
      Protein FAA:
        description: FASTA amino acid file for annotated proteins.
      MSGFjobs_MASIC_resultant.tsv:
        description: Tab delimited file of unfiltered metaproteomics results, both identifications and abundances.
      Peptide_Report.tsv:
        description: Tab delimited file of peptide results filtered to ~5% FDR, including protein and abundance information.
      Protein_Report.tsv:
        description: Tab delimited file of protein results derived from ~5% FDR filtered peptide data, including aggregated abundance information.
      QC_metrics.tsv:
        description: Tab delimited file of aggregate statistics derived from workflow results.
      
      
slots:

  object set:
    mixin: true
    domain: database
    multivalued: true
    inlined: true
    description:
      Applies to a property that links a database object to a set of objects.
      This is necessary in a json document to provide context for a list, and
      to allow for a single json object that combines multiple object types
  
  biosample set:
    mixins: object set
    domain: database
    range: biosample
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of samples within it.

  study set:
    mixins: object set
    domain: database
    range: study
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of studies within it.

  data object set:
    mixins: object set
    domain: database
    range: data object
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of data objects within it.
  
  genome feature set:
    mixins: object set
    domain: database
    range: genome feature
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of all features
  
  functional annotation set:
    mixins: object set
    domain: database
    range: functional annotation
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of all functional annotations
  
  activity set:
    mixins: object set
    domain: database
    range: workflow execution activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of workflow activities.
  
  mags activity set:
    mixins: object set
    domain: database
    range: MAGs analysis activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of MAGs analysis activities.

  metabolomics analysis activity set:
    mixins: object set
    domain: database
    range: metabolomics analysis activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of metabolomics analysis activities.

  metaproteomics analysis activity set:
    mixins: object set
    domain: database
    range: metaproteomics analysis activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of metaproteomics analysis activities.

  metagenome annotation activity set:
    mixins: object set
    domain: database
    range: metagenome annotation activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of metagenome annotation activities.

  metagenome assembly set:
    mixins: object set
    domain: database
    range: metagenome assembly
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of metagenome assembly activities.

  metatranscriptome activity set:
    mixins: object set
    domain: database
    range: metatranscriptome activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of metatranscriptome analysis activities.

  read QC analysis activity set:
    mixins: object set
    domain: database
    range: read QC analysis activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of read QC analysis activities.

  read based analysis activity set:
    mixins: object set
    domain: database
    range: read based analysis activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of read based analysis activities.
        
  nom analysis activity set:
    mixins: object set
    domain: database
    range: nom analysis activity
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of natural organic matter (NOM) analysis activities.

  omics processing set:
    mixins: object set
    domain: database
    range: omics processing
    multivalued: true
    inlined: true
    description: >-
      This property links a database object to the set of omics processings within it.

  omics type:
    range: controlled term value 
#    range: string
    description: >-
      The type of omics data
    examples:
      - value: metatranscriptome
      - value: metagenome
  
  data object type:
    range: file type enum
    description: >-
      The type of file represented by the data object.
    examples:
      - value: assembly_contigs.fna
      - value: assembly.agp
      
  compression type:
    range: string
    description: >-
      If provided, specifies the compression type
    examples:
      - value: gzip
    todos:
      - consider enum
          
  instrument_name:
    description: >-
      The name of the instrument that was used for processing the sample.
         
  ## GOLD PATHS
  gold_path_field:
    is_a: attribute
    range: string
    abstract: true
    description: >-
      This is a grouping for any of the gold path fields          
    
  ecosystem:
    is_a: gold_path_field
    description: >-
      TODO

  ecosystem_category:
    is_a: gold_path_field
    description: >-
      TODO

  ecosystem_type:
    is_a: gold_path_field
    description: >-
      TODO

  ecosystem_subtype:
    is_a: gold_path_field
    description: >-
      TODO

  specific_ecosystem:
    is_a: gold_path_field
    description: >-
      TODO

  ## GOLD DATABASE SPECFIC FIELDS
  principal investigator:
    aliases:
      - PI
    is_a: attribute
    range: person value
    description: >-
      represents the PI

  doi:
    is_a: attribute
    range: attribute value

  add_date:
    range: string
    description: >-
      The date on which the information was added to the database.

  mod_date:
    range: string
    description: >-
      The last date on which the database information was modified.

  ecosystem_path_id:
    range: string
    description: >-
      A unique id representing the GOLD classifers associated with a sample.

  habitat:
    range: string
    
  location:
    range: string
    
  community:
    range: string
    
  ncbi_taxonomy_name:
    range: string

  ncbi_project_name:
    range: string
  
  sample_collection_site:
    range: string
    
  identifier:
    range: string
    
  sample_collection_year:
    range: integer
    
  sample_collection_month:
    range: integer
    
  sample_collection_day:
    range: integer
    
  sample_collection_hour:
    range: integer
    
  sample_collection_minute:
    range: integer
    
  salinity_category:
    description: >-
      Categorcial description of the sample's salinity.
      Examples: halophile, halotolerant, hypersaline, huryhaline
    range: string
    see_also:
      - https://github.com/microbiomedata/nmdc-metadata/pull/297
      
  soluble_iron_micromol:
    range: string
    
  host_name:
    range: string
  
  depth2:
    range: quantity value

  subsurface_depth:
    range: quantity value
  
  subsurface_depth2:
    range: quantity value

  proport_woa_temperature:
    range: string
    
  biogas_temperature:
    range: string
    
  soil_annual_season_temp:
    range: string
    
  biogas_retention_time:
    range: string

  processing_institution:
    range: string
    description: >-
      The organization that processed the sample.
  
  omics_type:
    range: string
  
  completion_date:
    range: string

  external database identifiers:
    abstract: true
    multivalued: true
    description:
      Link to corresponding identifier in external database
    comments:
      The value of this field is always a registered CURIE
    range: external identifier
    close_mappings:
      - skos:closeMatch

  GOLD identifiers:
    mixin: true
    see_also:
      - https://gold.jgi.doe.gov/

  INSDC identifiers:
    mixin: true
    description: >-
      Any identifier covered by the International Nucleotide Sequence Database Collaboration
    comment:
      - the first letter of the accession indicates which partner accepted the initial submission: E for ENA, D for DDBJ, or S or N for NCBI.
    see_also:
      - https://www.insdc.org/
      - https://ena-docs.readthedocs.io/en/latest/submit/general-guide/accessions.html

  ## studies

  study identifiers:
    abstract: true
    domain: study
    is_a: external database identifiers
  
  INSDC SRA ENA studies:
    is_a: study identifiers
    mixins:
      - INSDC identifiers
    pattern: "^insdc.sra:(E|D|S)RP[0-9]{6,}$"
    multivalued: true
    description:
      - identifiers for corresponding project in INSDC SRA / ENA
    examples:
      - value: https://identifiers.org/insdc.sra:SRP121659
        description: Avena fatua rhizosphere microbial communities - H1_Rhizo_Litter_2 metatranscriptome
    see_also:
      - https://github.com/bioregistry/bioregistry/issues/109
      - https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=studies
      - https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=studies

  bioprojects:
    is_a: study identifiers
    mixins:
      - INSDC identifiers
    pattern: "^bioproject:PRJ[DEN][A-Z]\d+$"
    description:
      - identifiers for corresponding project in INSDC Bioproject
    comment:
      - these are distinct IDs from INSDC SRA/ENA project identifiers, but are usually(?) one to one
    examples:
      - value: https://identifiers.org/bioproject:PRJNA366857
        description: Avena fatua rhizosphere microbial communities - H1_Rhizo_Litter_2 metatranscriptome
    see_also:
      - https://www.ncbi.nlm.nih.gov/bioproject/
      - https://www.ddbj.nig.ac.jp/bioproject/index-e.html
        
  GOLD studies:
    is_a: study identifiers
    mixins:
      - GOLD identifiers
    pattern: "^GOLD:Gs\d+$"
    multivalued: true
    description:
      - identifiers for corresponding project in GOLD
    examples:
      - value: https://identifiers.org/gold:Gs0110115
    see_also:
      - https://gold.jgi.doe.gov/studies

  MGnify projects:
    is_a: study identifiers
    pattern: "^mgnify.proj:[A-Z]+[0-9]+$"
    description:
      - identifiers for corresponding project in MGnify
    examples:
      - value: https://identifiers.org/mgnify.proj:MGYS00005757
    
  ## samples

  sample identifiers:
    abstract: true
    domain: sample
    is_a: external database identifiers
  
  GOLD samples:
    is_a: sample identifiers
    mixins:
      - GOLD identifiers
    pattern: "^GOLD:Gb\d+$"
    multivalued: true
    description:
      - identifiers for corresponding sample in GOLD
    examples:
      - value: https://identifiers.org/gold:GbTODO

  INSDC biosamples:
    is_a: sample identifiers
    mixins:
      - INSDC identifiers
    pattern: "^biosample:SAM[NED](\w)?\d+$"
    multivalued: true
    description:
      - identifiers for corresponding sample in INSDC
    examples:
      - value: https://identifiers.org/biosample:SAMEA5989477
      - value: https://identifiers.org/biosample:SAMD00212331
        description: I13_N_5-10 sample from Soil fungal diversity along elevational gradients
    see_also:
      - https://github.com/bioregistry/bioregistry/issues/108
      - https://www.ebi.ac.uk/biosamples/
      - https://www.ncbi.nlm.nih.gov/biosample
      - https://www.ddbj.nig.ac.jp/biosample/index-e.html

  INSDC secondary sample identifiers:
    is_a: sample identifiers
    mixins:
      - INSDC identifiers
    pattern: "^biosample:(E|D|S)RS[0-9]{6,}$"
    description:
      - secondary identifiers for corresponding sample in INSDC
    comments:
      - ENA redirects these to primary IDs, e.g. https://www.ebi.ac.uk/ena/browser/view/DRS166340 -> SAMD00212331
      - MGnify uses these as their primary sample IDs
    examples:
      - value: https://identifiers.org/insdc.sra:DRS166340
        description: I13_N_5-10 sample from Soil fungal diversity along elevational gradients

  ## omics processing

  omics processing identifiers:
    abstract: true
    domain: omics processing
    is_a: external database identifiers
  
  GOLD sequencing projects:
    is_a: external database identifiers
    mixins:
      - GOLD identifiers
    pattern: "^GOLD:Gp\d+$"
    multivalued: true
    description:
      - identifiers for corresponding sequencing project in GOLD
    examples:
      - value: https://identifiers.org/gold:GpTODO

  INSDC experiments:
    is_a: external database identifiers
    pattern: "^insdc.sra:(E|D|S)RX[0-9]{6,}$"
    mixins:
      - INSDC identifiers
        
  ## analysis run

  analysis identifiers:
    abstract: true
    domain: workflow execution activity
    is_a: external database identifiers
  
  GOLD analysis projects:
    is_a: analysis identifiers
    mixins:
      - GOLD identifiers
    pattern: "^GOLD:Ga\d+$"
    multivalued: true
    description:
      - identifiers for corresponding analysis project in GOLD
    examples:
      - value: https://identifiers.org/gold:GaTODO

  INSDC analyses:
    is_a: analysis identifiers
    comment:
      - in INSDC this is a run but it corresponds to a GOLD analysis
    pattern: "^insdc.sra:(E|D|S)RR[0-9]{6,}$"
    mixins:
      - INSDC identifiers
    examples:
      - value: https://www.ebi.ac.uk/metagenomics/runs/DRR218479
        description: Illumina MiSeq paired end sequencing of SAMD00212331

  MGnify analyses:
    is_a: analysis identifiers
    #pattern: "^mgnify:MGYA\d+$"
    mixins:
      - INSDC identifiers
    examples:
      - value: https://www.ebi.ac.uk/metagenomics/runs/DRR218479
        description: Illumina MiSeq paired end sequencing of SAMD00212331

  ## assemblies

  assembly identifiers:
    abstract: true
    domain: metagenome assembly

  INSDC assembly identifiers:
    is_a: assembly identifiers
    pattern: "^insdc.sra:[A-Z]+[0-9]+(\.[0-9]+)?$"
    mixins:
      - INSDC identifiers
    
  
